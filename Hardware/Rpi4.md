---
arm_hardware: true
cmake_plat: rpi4
xcompiler_arg: -DAARCH64=1
platform: Raspberry Pi 4B
arch: ARMv8A
virtualization: ARM HYP
iommu: "No"
soc: BCM2711
cpu: Cortex-A72
Status: Unverified
Contrib: "[Hensoldt](https://hensoldt-cyber.com) and [ARM Research IceCap](https://gitlab.com/arm-research/security/icecap/icecap)"
Maintained: "[Hensoldt](https://hensoldt-cyber.com)"
SPDX-License-Identifier: CC-BY-SA-4.0
SPDX-FileCopyrightText: 2020 seL4 Project a Series of LF Projects, LLC.
---

# Raspberry Pi 4 Model B

## U-Boot

```bash
git clone https://github.com/u-boot/u-boot.git u-boot
cd u-boot
make CROSS_COMPILE=aarch64-linux-gnu- rpi_4_defconfig
make CROSS_COMPILE=aarch64-linux-gnu-
```

This will enable you to get the most up-to-date U-boot which will boot
seL4 on the RPi4 successfully.

## SD card setup
 The PI boots from the first FAT32 partition on the
SD card. Where files are specified, they should be located in the root
directory of this partition.

|Stage |Filename |Description |Source|
|-|-|-|-|
|FSBL |- |Mounts SD and loads SSBL |ROM |
|SSBL |bootcode.bin|Loads GPU firmware and boots GPU|<https://github.com/raspberrypi/firmware/tree/master/boot> |
|GPU firmware |start4.elf |Loads CPU bootloader and boots CPU |<https://github.com/raspberrypi/firmware/tree/master/boot> |
|Usually the Linux kernel, but could also be u-boot |u-boot.bin |u-boot| Compiled using the instructions above |
||config.txt|u-boot parameters |Add `arm_64bit=1`, `kernel=u-boot.bin`, and `dtoverlay=disable-bt` to the bottom of config.txt |
||uboot.env |u-boot saved environment |Generated by u-boot (default environment) bootcmd copied to bootcmd_orig bootcmd and bootdelay removed |
||bcm2711-rpi-4-b.dtb | RPi4 device tree blob |<https://github.com/raspberrypi/firmware/tree/master/boot> |
||overlays/* | Device tree overlays |<https://github.com/raspberrypi/firmware/tree/master/boot/overlays> |

## Getting seL4 onto your Raspberry Pi 4

### Building seL4Test

The last step is to build an seL4 image and run it on your RPi4. To do this, we will build the seL4Test project with the following commands:

{% include sel4test.md %}

### Running seL4Test

#### Serial connection
Serial TX and RX are located at GPIO pins 14 and 15 respectively. Connecting to this UART will enable you to see the output from U-Boot and seL4Test.

The boot method described here is through the SD card. You should set up the files
on your SD card as described above.

Following this, copy your seL4 image (such as an seL4test image) onto
the SD card in its root directory. You can now remove the SD
card from your PC and re-insert it into the RPi4, and power the RPi4 on.

When the RPi4 boots up, be sure to interrupt the boot process and drop
into the U-Boot command prompt.

From the command prompt, run the
command: `fatls mmc 0`. This will print out all the files on the SD card. If you don't see your seL4 image
filename printed out, then you might need to double-check your steps
so far to make sure you didn't forget something along the way. If you
see your file listed, then run the following commands to load the image into memory and then boot it.
```
fatload mmc 0 0x10000000 sel4test-driver-image-arm-bcm2711
bootefi 0x10000000
```
